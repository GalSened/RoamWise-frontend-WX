var w=Object.defineProperty;var _=(a,e,t)=>e in a?w(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var h=(a,e,t)=>_(a,typeof e!="symbol"?e+"":e,t);class y{constructor(e={}){h(this,"config");h(this,"eventQueue",[]);h(this,"perfQueue",[]);h(this,"flushTimer");h(this,"sessionId");this.config={enabled:!1,endpoint:"/api/telemetry",batchSize:10,flushInterval:3e4,...e},this.sessionId=this.generateSessionId(),this.config.enabled&&(this.startPeriodicFlush(),this.setupUnloadHandler(),this.trackPageView())}track(e,t){if(!this.config.enabled)return;const r={name:e,properties:{...t,userAgent:navigator.userAgent,url:window.location.href,referrer:document.referrer},timestamp:Date.now(),sessionId:this.sessionId,userId:this.config.userId};this.eventQueue.push(r),this.checkFlushThreshold()}trackPerformance(e,t,r){if(!this.config.enabled)return;const n={name:e,value:t,unit:r,timestamp:Date.now()};this.perfQueue.push(n),this.checkFlushThreshold()}trackError(e,t){this.config.enabled&&this.track("error",{message:e.message,stack:e.stack,name:e.name,...t})}trackUserAction(e,t,r){this.config.enabled&&this.track("user_action",{action:e,target:t,...r})}trackPageView(e){this.config.enabled&&this.track("page_view",{path:e||window.location.pathname,title:document.title})}measureTime(e,t){if(!this.config.enabled)return t();const r=performance.now(),n=t();return n instanceof Promise?n.finally(()=>{this.trackPerformance(e,performance.now()-r,"ms")}):(this.trackPerformance(e,performance.now()-r,"ms"),n)}setUser(e){this.config.userId=e}setProperty(e,t){globalThis.__telemetryGlobals||(globalThis.__telemetryGlobals={}),globalThis.__telemetryGlobals[e]=t}generateSessionId(){return"".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))}startPeriodicFlush(){this.flushTimer=window.setInterval(()=>{this.flush()},this.config.flushInterval)}setupUnloadHandler(){const e=()=>{this.flush(!0)};window.addEventListener("beforeunload",e),window.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this.flush()})}checkFlushThreshold(){this.eventQueue.length+this.perfQueue.length>=this.config.batchSize&&this.flush()}async flush(e=!1){if(this.eventQueue.length===0&&this.perfQueue.length===0)return;const t=[...this.eventQueue],r=[...this.perfQueue];this.eventQueue=[],this.perfQueue=[];const n={events:t.map(o=>({...o,properties:{...o.properties,...globalThis.__telemetryGlobals}})),metrics:r,sessionId:this.sessionId,timestamp:Date.now()};try{e&&"sendBeacon"in navigator?navigator.sendBeacon(this.config.endpoint,JSON.stringify(n)):await fetch(this.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json",...this.config.apiKey&&{Authorization:"Bearer ".concat(this.config.apiKey)}},body:JSON.stringify(n),keepalive:!0})}catch(o){console.warn("Failed to send telemetry:",o),this.eventQueue.length<100&&(this.eventQueue.unshift(...t.slice(-50)),this.perfQueue.unshift(...r.slice(-50)))}}destroy(){this.flushTimer&&clearInterval(this.flushTimer),this.flush(!0)}}function b(){if("PerformanceObserver"in window)try{new PerformanceObserver(n=>{const o=n.getEntries(),i=o[o.length-1];i&&f.trackPerformance("lcp",i.startTime,"ms")}).observe({entryTypes:["largest-contentful-paint"]}),new PerformanceObserver(n=>{n.getEntries().forEach(i=>{f.trackPerformance("fid",i.processingStart-i.startTime,"ms")})}).observe({entryTypes:["first-input"]});let t=0;new PerformanceObserver(n=>{n.getEntries().forEach(i=>{i.hadRecentInput||(t+=i.value)})}).observe({entryTypes:["layout-shift"]}),window.addEventListener("beforeunload",()=>{f.trackPerformance("cls",t)})}catch(a){console.warn("Web Vitals tracking failed:",a)}}const f=new y;typeof window<"u"&&b();const E=Object.freeze(Object.defineProperty({__proto__:null,telemetry:f},Symbol.toStringTag,{value:"Module"}));class m extends Error{constructor(e,t,r,n=!1){super(e),this.code=t,this.statusCode=r,this.retryable=n,this.name="AppError"}}class T{constructor(e){h(this,"config");h(this,"service");this.config=e,this.initializeService()}async initializeService(){if(this.service)return;typeof google>"u"&&await this.loadGoogleMapsAPI();const e=document.createElement("div");this.service=new google.maps.places.PlacesService(e)}loadGoogleMapsAPI(){return new Promise((e,t)=>{if(typeof google<"u"){e();return}const r=document.createElement("script");r.src="https://maps.googleapis.com/maps/api/js?key=".concat(this.config.apiKey,"&libraries=places&language=").concat(this.config.language||"en"),r.async=!0,r.defer=!0,r.onload=()=>e(),r.onerror=()=>t(new m("Failed to load Google Maps API","MAPS_API_LOAD_FAILED")),document.head.appendChild(r)})}async search(e,t={}){const r=performance.now();try{await this.initializeService();const n={query:e,location:t.near?new google.maps.LatLng(t.near.lat,t.near.lng):void 0,radius:t.radius||5e3,type:t.type,openNow:t.openNow},i=(await new Promise((u,s)=>{this.service.textSearch(n,(l,c)=>{c===google.maps.places.PlacesServiceStatus.OK&&l?u(l):s(new m("Places search failed: ".concat(c),"PLACES_SEARCH_FAILED"))})})).map(this.transformPlace).filter(Boolean);return f.track("places_search",{query:e,results_count:i.length,duration:performance.now()-r,has_location:!!t.near}),i}catch(n){throw f.track("places_search_error",{query:e,error:n instanceof Error?n.message:"Unknown error",duration:performance.now()-r}),n}}async details(e){const t=performance.now();try{await this.initializeService();const r={placeId:e,fields:["place_id","name","formatted_address","geometry","rating","user_ratings_total","price_level","types","opening_hours","formatted_phone_number","website","reviews","photos","vicinity"]},n=await new Promise((i,u)=>{this.service.getDetails(r,(s,l)=>{l===google.maps.places.PlacesServiceStatus.OK&&s?i(s):u(new m("Place details failed: ".concat(l),"PLACE_DETAILS_FAILED"))})}),o=this.transformPlaceDetail(n);return f.track("place_details",{place_id:e,duration:performance.now()-t}),o}catch(r){throw f.track("place_details_error",{place_id:e,error:r instanceof Error?r.message:"Unknown error",duration:performance.now()-t}),r}}async photos(e,t=5){var r;try{return((r=(await this.details(e)).photos)==null?void 0:r.slice(0,t))||[]}catch(n){return console.warn("Failed to get place photos:",n),[]}}transformPlace(e){var t,r,n;return!e.place_id||!e.name||!((t=e.geometry)!=null&&t.location)?null:{id:e.place_id,name:e.name,address:e.formatted_address,location:{lat:e.geometry.location.lat(),lng:e.geometry.location.lng()},rating:e.rating,userRatingsTotal:e.user_ratings_total,priceLevel:e.price_level,types:e.types,openNow:(r=e.opening_hours)==null?void 0:r.open_now,photos:(n=e.photos)==null?void 0:n.map(o=>({url:o.getUrl({maxWidth:400,maxHeight:300}),width:400,height:300,attributions:o.html_attributions}))}}transformPlaceDetail(e){var r,n;const t=this.transformPlace(e);if(!t)throw new m("Invalid place data","INVALID_PLACE_DATA");return{...t,formattedAddress:e.formatted_address||t.address||"",phoneNumber:e.formatted_phone_number,website:e.website,openingHours:e.opening_hours?{openNow:e.opening_hours.open_now||!1,periods:((r=e.opening_hours.periods)==null?void 0:r.map(o=>{var i,u;return{open:{day:((i=o.open)==null?void 0:i.day)||0,time:((u=o.open)==null?void 0:u.time)||"0000"},close:o.close?{day:o.close.day,time:o.close.time}:void 0}}))||[],weekdayText:e.opening_hours.weekday_text||[]}:void 0,reviews:(n=e.reviews)==null?void 0:n.map(o=>({author:o.author_name,rating:o.rating,text:o.text,time:o.time})),vicinity:e.vicinity}}}class S{constructor(e){h(this,"config");h(this,"service");this.config=e,this.initializeService()}async initializeService(){this.service||(typeof google>"u"&&await this.loadGoogleMapsAPI(),this.service=new google.maps.DirectionsService)}loadGoogleMapsAPI(){return new Promise((e,t)=>{if(typeof google<"u"){e();return}const r=document.createElement("script");r.src="https://maps.googleapis.com/maps/api/js?key=".concat(this.config.apiKey,"&language=").concat(this.config.language||"en"),r.async=!0,r.defer=!0,r.onload=()=>e(),r.onerror=()=>t(new m("Failed to load Google Maps API","MAPS_API_LOAD_FAILED")),document.head.appendChild(r)})}async route(e){var r,n;const t=performance.now();try{await this.initializeService();const o={origin:new google.maps.LatLng(e.origin.lat,e.origin.lng),destination:new google.maps.LatLng(e.destination.lat,e.destination.lng),waypoints:(r=e.via)==null?void 0:r.map(s=>({location:new google.maps.LatLng(s.lat,s.lng),stopover:!0})),travelMode:this.getTravelMode(e.mode||"car"),avoidTolls:e.avoidTolls||!1,drivingOptions:e.departTime?{departureTime:e.departTime,trafficModel:google.maps.TrafficModel.BEST_GUESS}:void 0,unitSystem:google.maps.UnitSystem.METRIC},i=await new Promise((s,l)=>{this.service.route(o,(c,d)=>{d===google.maps.DirectionsStatus.OK&&c?s(c):l(new m("Route calculation failed: ".concat(d),"ROUTE_CALCULATION_FAILED"))})}),u=this.transformRoute(i);return f.track("route_calculation",{mode:e.mode,has_waypoints:!!((n=e.via)!=null&&n.length),duration:performance.now()-t,distance:u.overview.distance,travel_time:u.overview.duration}),u}catch(o){throw f.track("route_calculation_error",{mode:e.mode,error:o instanceof Error?o.message:"Unknown error",duration:performance.now()-t}),o}}getTravelMode(e){switch(e){case"walk":return google.maps.TravelMode.WALKING;case"bike":return google.maps.TravelMode.BICYCLING;case"transit":return google.maps.TravelMode.TRANSIT;default:return google.maps.TravelMode.DRIVING}}transformRoute(e){var r,n,o,i,u;const t=e.routes[0];if(!t)throw new m("No route found","NO_ROUTE_FOUND");return{legs:t.legs.map(s=>{var l,c;return{start:{lat:s.start_location.lat(),lng:s.start_location.lng()},end:{lat:s.end_location.lat(),lng:s.end_location.lng()},duration:((l=s.duration)==null?void 0:l.value)||0,distance:((c=s.distance)==null?void 0:c.value)||0,steps:s.steps.map(d=>{var g,p,v;return{instruction:d.instructions,duration:((g=d.duration)==null?void 0:g.value)||0,distance:((p=d.distance)==null?void 0:p.value)||0,start:{lat:d.start_location.lat(),lng:d.start_location.lng()},end:{lat:d.end_location.lat(),lng:d.end_location.lng()},polyline:((v=d.polyline)==null?void 0:v.points)||"",maneuver:d.maneuver}}),polyline:s.steps.map(d=>{var g;return(g=d.polyline)==null?void 0:g.points}).join("")}}),overview:{polyline:((r=t.overview_polyline)==null?void 0:r.points)||"",bounds:{north:((n=t.bounds)==null?void 0:n.getNorthEast().lat())||0,south:((o=t.bounds)==null?void 0:o.getSouthWest().lat())||0,east:((i=t.bounds)==null?void 0:i.getNorthEast().lng())||0,west:((u=t.bounds)==null?void 0:u.getSouthWest().lng())||0},duration:t.legs.reduce((s,l)=>{var c;return s+(((c=l.duration)==null?void 0:c.value)||0)},0),distance:t.legs.reduce((s,l)=>{var c;return s+(((c=l.distance)==null?void 0:c.value)||0)},0)},warnings:t.warnings,summary:t.summary}}}function k(a){const e={apiKey:a,language:"en",region:"US"};return{places:new T(e),routing:new S(e)}}export{m as A,k as c,E as i,f as t};
//# sourceMappingURL=maps-COZuNwZo.js.map
